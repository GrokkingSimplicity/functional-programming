# 7, 신뢰할 수 없는 코드를 쓰면서 불변성 지키기
> <i>안전지대에서는 데이터를 전달할 때 많은 복사를 하지 않아도 됩니다. 많은 복사본 때문에 연산과 메모리를 낭비하는 것을 막으려면 가능한 안전지대에서는 카피-온-라이트를 사용하는 것이 좋습니다. 그래서 두 원칙은 함께 사용해야 합니다.(p.157) </i>

카피 온 라이트와, 방어적 복사는 비슷한 듯 다른데, 둘의 차이점과 어떤 상황에서 사용할지 명확하게 알게 됐다. 

# 8. 계층형 설계란 무엇인가요? (직접 설계)
> <i>같은 박스를 가리킨다는 것은 같은 계층에 있어도 좋다는 정보입니다.(p.181)</i>
> <i>같은 계층에 있는 함수는 같은 목적을 가져야 합니다.(p.185)</i>

작접 설계하는 과정에서 모호한 부분이 많다고 느꼈다. 그 과정에서 위 문장들은 여러 상황에서도 기준을 잡는데 도움이 될 것 같다는 생각이 들었다.

<br/>

> <i>어떻게 하면 화살표를 같은 길이로 만들 수 있을까요? 가장 일반적인 방법은 중간에 함수를 두는 것입니다.(p.188)</i>

`화살표의 길이를 맞추는 것===같은 계층` 이기 때문에 직접 설계에서 중요한 부분인데, 통일되게 하위 계층을 참조하려면 계층이 더 낮은 함수를 랩핑하는 함수를 두면 된다는 것을 알게됐다. 간단한데 생각하지 못한 방법이어서 더 실용적으로 다가왔다!

<br/>

> <i>설계는 어렵고, 개발자들도 서로 동의하지 않을 수도 있고, 상황에 따라 좋은 설계의 기준이 달라지기도 합니다.(p.196)</i>

설계는 어렵고, 개발자에 따라서 생각하는게 다르다는 말이 매우 공감됐다. 설계에 대해 다양한 패턴이 존재해야하는 이유라고 생각이 들었다. 상황에 따라 어떤 패턴과 설계를 적용할지 함께 고민해보면 좋을 것 같다.

<br/>

> <i>계층형 설계에서 모든 계층은 바로 아래 계층에 의존해야 합니다. 복잡한 코드를 같은 계층으로 옮기면 안됩니다. 더 낮은 구체화 수준을 가진 일반적인 함수를 만들어 소프트웨어에 직접 구현 패턴을 적용해야 합니다.(p.198)</i>

함수가 바로 아래 계층에만 의지할 수 있을까 ? 그렇게 되면 너무 많은 코드와 분할이 이뤄지지 않을까 ? 또 비즈니스와 밀접한 함수들을 계층을 맞추기 위해 랩핑하게 돼면 재사용되지 않는 코드들이 너무 많아지는 것 아닐까?,, 하는 생각도 들었다 🤔

<br/>

# 용어 정리
- off-by-one: 주로 배열을 반복해서 처리할 때 '크다' 또는 '크거나 같다'와 같은 비교문을 잘못 선택해서 의도치않게 마지막 항목을 처리하지 못하거나 처리하는 오류를 말합니다.

# 느낀점
- 이전 챕터에서 카피-온-라이트시 깊은 복사가 필요하다고 생각했고, 그래서 실무에 적용할 때 어려움이 있을것이라고 생각했다. 챕터 7에서 외부 라이브러리를 사용할 때만 깊은 복사가 필요하다는 것을 알게 됐다. 보다 실무에 적용하기 좋을 것 같다는 생각이 들었다.
- 계층형 설계가 아직은 모호하게 느껴진다. 계층을 나누는 기준은 모두가 다르고, 그게 얼마나 많은 레이어를 가질지는 개발 상황에 따라 달라질 것 같다. 적정한 레이어는 어느정도 일지, 이론을 쫓다가 실무에서의 개발 경험을 낮추게 되진 않을지 고민이 됐다.

